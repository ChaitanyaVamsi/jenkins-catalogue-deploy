pipeline{
  agent{
    node{
      label 'slave'
    }
  }

  environment{
         COURSE = "Jenkins"
        appVersion = ""
        ACC_ID = "160885265516"
        PROJECT = "roboshop"
        COMPONENT = "catalogue"
        REGION = "us-east-1"
  }

  options{
    timeout(time: 30, unit: 'MINUTES')
    disableConcurrentBuilds()
  }

  parameters {
        string(name: 'appVersion', description: 'Which app version you want to deploy')
        choice(name: 'deploy_to', choices: ['dev', 'qa', 'prod'], description: 'Pick something')
    }

    stages{
      stage('deploy'){
        steps{
          script{
            withAWS(region:'us-east-1',credentials:'aws-creds') {
                sh """
                        aws eks update-kubeconfig --region ${REGION} --name ${PROJECT}-${params.deploy_to}
                        kubectl get nodes
                  """
            }

          }
        }
      }
    }
}